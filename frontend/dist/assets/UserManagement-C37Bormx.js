import{_ as E,r as i,o as P,h as f,c as a,d as n,e as s,i as c,F as A,j as I,f as u,v,w as k,t as y,x as L}from"./index-CR4645Pn.js";const N={class:"user-management"},j={class:"page-header"},z={class:"card-header"},R={class:"user-list"},S={key:0,class:"loading"},T={key:1,class:"table-container"},q={class:"data-table"},G=["onClick"],H=["onClick"],J=["onClick"],K={class:"dialog-header"},O={class:"dialog-body"},Q={class:"form-group"},W={class:"form-group"},X={class:"form-group"},Y={class:"dialog-footer"},Z={class:"dialog-header"},_={class:"dialog-body"},h={class:"form-group"},ll={class:"form-group"},sl={class:"form-group"},el={class:"dialog-footer"},ol={class:"dialog-header"},tl={class:"dialog-body"},al={class:"form-group"},nl={class:"form-group"},rl={class:"dialog-footer"},dl={__name:"UserManagement",setup(il){const w=i(!1),C=i([]),m=i(!1),p=i(!1),b=i(!1),r=i({username:"",password:"",email:""}),t=i({id:null,username:"",email:"",password:""}),d=i({username:"",password:""});P(()=>{g()});const g=async()=>{try{w.value=!0;const o=await f.getUsers();o.code===0?C.value=o.data||[]:alert("加载用户列表失败: "+(o.msg||""))}catch(o){console.error("加载用户列表失败:",o),alert("加载用户列表失败")}finally{w.value=!1}},$=async()=>{try{const o=await f.addUser(r.value);console.log(o),o.code===0?(alert("用户添加成功"),m.value=!1,r.value={username:"",password:"",email:""},g()):alert("用户添加失败: "+(o.msg||""))}catch(o){console.error("添加用户失败:",o),alert("添加用户失败")}},V=o=>{t.value={id:o.id,username:o.username,email:o.email||"",password:""},p.value=!0},D=async()=>{try{const o=await f.updateUser(t.value.id,t.value);o.code===0?(alert("用户更新成功"),p.value=!1,t.value={id:null,username:"",email:"",role:"user",password:""},g()):alert("用户更新失败: "+(o.msg||""))}catch(o){console.error("更新用户失败:",o),alert("更新用户失败")}},x=o=>{d.value={username:o.username,password:""},b.value=!0},F=async()=>{try{const o=await f.resetPassword(d.value.username,d.value.password);o.code===0?(alert("密码重置成功"),b.value=!1,d.value={username:"",password:""}):alert("密码重置失败: "+(o.msg||""))}catch(o){console.error("重置密码失败:",o),alert("重置密码失败")}},M=async o=>{if(confirm("确定要删除用户 "+o.username+" 吗？"))try{const l=await f.deleteUser(o.id);l.code===0?(alert("用户删除成功"),g()):alert("用户删除失败: "+(l.msg||""))}catch(l){console.error("删除用户失败:",l),alert("删除用户失败")}},B=o=>o?new Date(o).toLocaleString():"";return(o,l)=>(n(),a("div",N,[s("div",j,[s("div",z,[l[21]||(l[21]=s("h2",null,"用户管理",-1)),s("button",{class:"btn btn-primary",onClick:l[0]||(l[0]=e=>m.value=!0)}," 添加用户 ")])]),s("div",R,[w.value?(n(),a("div",S,"加载中...")):(n(),a("div",T,[s("table",q,[l[22]||(l[22]=s("thead",null,[s("tr",null,[s("th",null,"ID"),s("th",null,"用户名"),s("th",null,"角色"),s("th",null,"创建时间"),s("th",null,"操作")])],-1)),s("tbody",null,[(n(!0),a(A,null,I(C.value,e=>(n(),a("tr",{key:e.id},[s("td",null,y(e.id),1),s("td",null,y(e.username),1),s("td",null,[s("span",{class:L(["role-tag",e.role])},y(e.role==="admin"?"管理员":"普通用户"),3)]),s("td",null,y(B(e.created_at)),1),s("td",null,[s("button",{class:"btn btn-small",onClick:U=>V(e)},"编辑",8,G),s("button",{class:"btn btn-small",onClick:U=>x(e)},"重置密码",8,H),e.role!=="admin"?(n(),a("button",{key:0,class:"btn btn-small btn-danger",onClick:U=>M(e)},"删除",8,J)):c("",!0)])]))),128))])])]))]),m.value?(n(),a("div",{key:0,class:"dialog-overlay",onClick:l[7]||(l[7]=e=>m.value=!1)},[s("div",{class:"dialog",onClick:l[6]||(l[6]=k(()=>{},["stop"]))},[s("div",K,[l[23]||(l[23]=s("h3",null,"添加用户",-1)),s("button",{class:"close-btn",onClick:l[1]||(l[1]=e=>m.value=!1)},"×")]),s("div",O,[s("div",Q,[l[24]||(l[24]=s("label",null,"用户名",-1)),u(s("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>r.value.username=e),placeholder:"请输入用户名"},null,512),[[v,r.value.username]])]),s("div",W,[l[25]||(l[25]=s("label",null,"密码",-1)),u(s("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>r.value.password=e),type:"password",placeholder:"请输入密码"},null,512),[[v,r.value.password]])]),s("div",X,[l[26]||(l[26]=s("label",null,"邮箱",-1)),u(s("input",{"onUpdate:modelValue":l[4]||(l[4]=e=>r.value.email=e),type:"email",placeholder:"请输入邮箱"},null,512),[[v,r.value.email]])])]),s("div",Y,[s("button",{class:"btn",onClick:l[5]||(l[5]=e=>m.value=!1)},"取消"),s("button",{class:"btn btn-primary",onClick:$},"确定")])])])):c("",!0),p.value?(n(),a("div",{key:1,class:"dialog-overlay",onClick:l[14]||(l[14]=e=>p.value=!1)},[s("div",{class:"dialog",onClick:l[13]||(l[13]=k(()=>{},["stop"]))},[s("div",Z,[l[27]||(l[27]=s("h3",null,"编辑用户",-1)),s("button",{class:"close-btn",onClick:l[8]||(l[8]=e=>p.value=!1)},"×")]),s("div",_,[s("div",h,[l[28]||(l[28]=s("label",null,"用户名",-1)),u(s("input",{"onUpdate:modelValue":l[9]||(l[9]=e=>t.value.username=e),placeholder:"请输入用户名"},null,512),[[v,t.value.username]])]),s("div",ll,[l[29]||(l[29]=s("label",null,"邮箱",-1)),u(s("input",{"onUpdate:modelValue":l[10]||(l[10]=e=>t.value.email=e),placeholder:"请输入邮箱"},null,512),[[v,t.value.email]])]),s("div",sl,[l[30]||(l[30]=s("label",null,"新密码（可选）",-1)),u(s("input",{"onUpdate:modelValue":l[11]||(l[11]=e=>t.value.password=e),type:"password",placeholder:"留空表示不修改密码"},null,512),[[v,t.value.password]])])]),s("div",el,[s("button",{class:"btn",onClick:l[12]||(l[12]=e=>p.value=!1)},"取消"),s("button",{class:"btn btn-primary",onClick:D},"确定")])])])):c("",!0),b.value?(n(),a("div",{key:2,class:"dialog-overlay",onClick:l[20]||(l[20]=e=>b.value=!1)},[s("div",{class:"dialog",onClick:l[19]||(l[19]=k(()=>{},["stop"]))},[s("div",ol,[l[31]||(l[31]=s("h3",null,"重置密码",-1)),s("button",{class:"close-btn",onClick:l[15]||(l[15]=e=>b.value=!1)},"×")]),s("div",tl,[s("div",al,[l[32]||(l[32]=s("label",null,"用户名",-1)),u(s("input",{"onUpdate:modelValue":l[16]||(l[16]=e=>d.value.username=e),readonly:""},null,512),[[v,d.value.username]])]),s("div",nl,[l[33]||(l[33]=s("label",null,"新密码",-1)),u(s("input",{"onUpdate:modelValue":l[17]||(l[17]=e=>d.value.password=e),type:"password",placeholder:"请输入新密码"},null,512),[[v,d.value.password]])])]),s("div",rl,[s("button",{class:"btn",onClick:l[18]||(l[18]=e=>b.value=!1)},"取消"),s("button",{class:"btn btn-primary",onClick:F},"确定")])])])):c("",!0)]))}},vl=E(dl,[["__scopeId","data-v-cb953e4b"]]);export{vl as default};
