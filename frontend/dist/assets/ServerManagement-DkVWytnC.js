import{_ as q,r,g as A,o as B,s as p,h as F,c as a,d as o,e,i as w,F as k,j as y,t as d,f as b,v as C,w as U,k as N,l as L}from"./index-CR4645Pn.js";const T={class:"server-management"},j={class:"page-header"},E={class:"card-header"},z={class:"server-list"},G={key:0,class:"loading"},H={key:1,class:"table-container"},J={class:"data-table"},K=["onClick"],O=["onClick"],Q=["onClick"],R={class:"dialog-header"},W={class:"dialog-body"},X={class:"form-group"},Y={class:"form-group"},Z={class:"form-group"},ee={class:"dialog-footer"},se={class:"dialog-header"},le={class:"dialog-body"},te={class:"user-list"},ae=["value"],oe={class:"dialog-footer"},ne={__name:"ServerManagement",setup(re){const f=r(!1),h=r([]),S=r([]),i=r(!1),v=r(!1),m=r(null),_=r(null),g=r([]),n=r({server_name:"",ip_address:"",port:22});A(()=>({server_name:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],ip_address:[{required:!0,message:"请输入IP地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}]})),B(()=>{c(),$()});const c=async()=>{try{f.value=!0;const l=await p.getServers();l.code===0?h.value=l.data||[]:alert("加载服务器列表失败: "+(l.msg||""))}catch(l){console.error("加载服务器列表失败:",l),alert("加载服务器列表失败")}finally{f.value=!1}},$=async()=>{try{const l=await F.getUsers();l.code===0?S.value=l.data||[]:console.error("加载用户列表失败:",l.msg)}catch(l){console.error("加载用户列表失败:",l)}},x=l=>{m.value=l,n.value={server_name:l.server_name,ip_address:l.ip_address,port:l.port},i.value=!0},D=async()=>{try{if(m.value){const l=await p.updateServer(m.value.id,n.value);l.code===0?(alert("服务器更新成功"),i.value=!1,c()):alert("服务器更新失败: "+(l.msg||""))}else{const l=await p.addServer(n.value);l.code===0?(alert("服务器添加成功"),i.value=!1,c()):alert("服务器添加失败: "+(l.msg||""))}}catch(l){console.error("保存服务器失败:",l),alert("保存服务器失败")}},I=async l=>{if(confirm("确定要删除服务器 "+l.server_name+" 吗？"))try{const s=await p.deleteServer(l.id);s.code===0?(alert("服务器删除成功"),c()):alert("服务器删除失败: "+(s.msg||""))}catch(s){console.error("删除服务器失败:",s),alert("删除服务器失败")}},V=l=>{_.value=l,g.value=l.users.map(s=>s.id),v.value=!0},M=async()=>{try{const l=await p.updateServer(_.value.id,{user_ids:g.value});l.code===0?(alert("用户关联更新成功"),v.value=!1,c()):alert("用户关联更新失败: "+(l.msg||""))}catch(l){console.error("更新用户关联失败:",l),alert("更新用户关联失败")}},P=l=>l?new Date(l).toLocaleString():"";return(l,s)=>(o(),a("div",T,[e("div",j,[e("div",E,[s[13]||(s[13]=e("h2",null,"服务器管理",-1)),e("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=t=>i.value=!0)}," 添加服务器 ")])]),e("div",z,[f.value?(o(),a("div",G,"加载中...")):(o(),a("div",H,[e("table",J,[s[14]||(s[14]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"服务器名称"),e("th",null,"IP地址"),e("th",null,"端口"),e("th",null,"关联用户"),e("th",null,"创建时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(o(!0),a(k,null,y(h.value,t=>(o(),a("tr",{key:t.id},[e("td",null,d(t.id),1),e("td",null,d(t.server_name),1),e("td",null,d(t.ip_address),1),e("td",null,d(t.port),1),e("td",null,[(o(!0),a(k,null,y(t.users,u=>(o(),a("span",{key:u.id,class:"user-tag"},d(u.username),1))),128))]),e("td",null,d(P(t.created_at)),1),e("td",null,[e("button",{class:"btn btn-small",onClick:u=>x(t)},"编辑",8,K),e("button",{class:"btn btn-small",onClick:u=>V(t)},"管理用户",8,O),e("button",{class:"btn btn-small btn-danger",onClick:u=>I(t)},"删除",8,Q)])]))),128))])])]))]),i.value?(o(),a("div",{key:0,class:"dialog-overlay",onClick:s[7]||(s[7]=t=>i.value=!1)},[e("div",{class:"dialog",onClick:s[6]||(s[6]=U(()=>{},["stop"]))},[e("div",R,[e("h3",null,d(m.value?"编辑服务器":"添加服务器"),1),e("button",{class:"close-btn",onClick:s[1]||(s[1]=t=>i.value=!1)},"×")]),e("div",W,[e("div",X,[s[15]||(s[15]=e("label",null,"服务器名称",-1)),b(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>n.value.server_name=t),placeholder:"请输入服务器名称"},null,512),[[C,n.value.server_name]])]),e("div",Y,[s[16]||(s[16]=e("label",null,"IP地址",-1)),b(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>n.value.ip_address=t),placeholder:"请输入IP地址"},null,512),[[C,n.value.ip_address]])]),e("div",Z,[s[17]||(s[17]=e("label",null,"端口",-1)),b(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>n.value.port=t),type:"number",placeholder:"请输入端口"},null,512),[[C,n.value.port]])])]),e("div",ee,[e("button",{class:"btn",onClick:s[5]||(s[5]=t=>i.value=!1)},"取消"),e("button",{class:"btn btn-primary",onClick:D},"确定")])])])):w("",!0),v.value?(o(),a("div",{key:1,class:"dialog-overlay",onClick:s[12]||(s[12]=t=>v.value=!1)},[e("div",{class:"dialog",onClick:s[11]||(s[11]=U(()=>{},["stop"]))},[e("div",se,[e("h3",null,"管理用户 - "+d(_.value?.server_name),1),e("button",{class:"close-btn",onClick:s[8]||(s[8]=t=>v.value=!1)},"×")]),e("div",le,[e("div",te,[(o(!0),a(k,null,y(S.value,t=>(o(),a("div",{key:t.id,class:"user-item"},[e("label",null,[b(e("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":s[9]||(s[9]=u=>g.value=u)},null,8,ae),[[L,g.value]]),N(" "+d(t.username),1)])]))),128))])]),e("div",oe,[e("button",{class:"btn",onClick:s[10]||(s[10]=t=>v.value=!1)},"取消"),e("button",{class:"btn btn-primary",onClick:M},"确定")])])])):w("",!0)]))}},ie=q(ne,[["__scopeId","data-v-69174175"]]);export{ie as default};
